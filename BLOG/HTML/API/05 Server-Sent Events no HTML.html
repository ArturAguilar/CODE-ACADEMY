<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server-Sent Events no HTML</title>
    <link rel="shortcut icon" href="../../../IMG/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="api.css">
</head>
<body>
    <div class="conteiner">
        <nav>
            <a href="../html.html">Voltar para o in√≠cio</a>
        </nav>
        
        <h1>Server-Sent Events (SSE) no HTML5 üîÑ</h1>
        <p>O SSE permite que o servidor envie atualiza√ß√µes autom√°ticas para o navegador via HTTP.</p>
        <p>‚úÖ Vantagem: Comunica√ß√£o unidirecional eficiente (servidor ‚Üí cliente).</p>
        <p>‚ùå Limita√ß√£o: Apenas o servidor pode enviar mensagens; o cliente n√£o pode enviar de volta.</p>

        <hr> 

        <h2>Criando um Server-Sent Event</h2>
        <h3>Configurando o Servidor SSE</h3>
        <p>üìå Crie um arquivo server.php para enviar eventos cont√≠nuos:</p>
        <div class="code">
            <p>
                <?php <br>
                header("Content-Type: text/event-stream"); <br>
                header("Cache-Control: no-cache"); <br>
                header("Connection: keep-alive"); <br><br>
              
                while (true) { <br>
                  echo "data: Atualiza√ß√£o do servidor: " . date("H:i:s") . "\n\n"; <br>
                  ob_flush(); <br>
                  flush(); <br>
                  sleep(2); // Atualiza a cada 2 segundos <br>
                } <br>
              ?>              
            </p>
        </div>

        <h3>Criando o Cliente SSE no HTML</h3>
        <p>üìå No arquivo HTML, conecte-se ao servidor SSE:</p>
        <div class="code">
            <p>
                &LT;script&GT;<br>
                if (typeof(EventSource) !== "undefined") {<br>
                  let source = new EventSource("server.php");<br><br>
              
                  source.onmessage = function(event) {<br>
                    document.getElementById("result").innerHTML += event.data + "&LT;br>";<br>
                  };<br>
                } else {<br>
                  alert("Seu navegador n√£o suporta SSE.");<br>
                }<br>
              &LT;/script&GT;<br><br>
              
              &LT;p id="result"&GT;&LT;/p&GT;              
            </p>
        </div>

        <hr>

        <h2>Explica√ß√£o do C√≥digo</h2>
        <p>1Ô∏è‚É£ O servidor (PHP) envia dados continuamente.</p>
        <p>2Ô∏è‚É£ O navegador (JavaScript) recebe os dados automaticamente sem precisar de requisi√ß√µes repetitivas (polling).</p>
        <p>3Ô∏è‚É£ A fun√ß√£o onmessage exibe as atualiza√ß√µes no HTML.</p>

        <hr>

        <h2>M√©todos e Eventos do SSE</h2>
        <p><strong>üìå Manipular mensagens personalizadas</strong></p>
        <p>O servidor pode enviar eventos nomeados:</p>
        <div class="code">
            <p>
                echo "event: alerta\n"; <br>
                echo "data: Mensagem personalizada\n\n";                
            </p>
        </div>

        <p>O cliente pode escut√°-los:</p>
        <div class="code">
            <p>
                source.addEventListener("alerta", function(event) {<br>
                    alert(event.data);<br>
                  }, false);                  
            </p>
        </div>

        <p><strong>üìå Fechar conex√£o SSE no cliente</strong></p>
        <div class="code">
            <p>source.close();</p>
        </div>

        <hr>

        <h2>Quando Usar Server-Sent Events?</h2>
        <p>‚úÖ Atualiza√ß√µes autom√°ticas (not√≠cias, cota√ß√µes, clima).</p>
        <p>‚úÖ Monitoramento em tempo real (logs, pain√©is de controle).</p>
        <p>‚úÖ Chats unidirecionais (avisos do sistema).</p>
        <p>‚ö†Ô∏è Limita√ß√µes:</p>
        <p style="padding-left: 20px;">‚ùå Apenas o servidor pode enviar mensagens.</p>
        <p style="padding-left: 20px;">‚ùå N√£o funciona em HTTP/2 com multiplexa√ß√£o.</p>
        <p style="padding-left: 20px;">‚ùå N√£o suporta WebSockets (para comunica√ß√£o bidirecional, use WebSockets).</p>

        <hr>

        <h2>Conclus√£o</h2>
        <p>üìå SSE √© uma solu√ß√£o simples e eficiente para streaming de dados do servidor para o cliente.</p>
        <p>üìå Menos consumo de recursos do que polling ou WebSockets, mas unidirecional.</p>
        <p>üìå Ideal para notifica√ß√µes e atualiza√ß√µes autom√°ticas sem sobrecarregar o servidor.</p>
    </div>
</body>
</html>